<p><link rel='stylesheet' href='../assets/css/main.css'/></p>
<p><a href="../README.html">&lt;&lt; back to main index</a></p>
<h1 id="lab-7.5-kafka-streaming---groupby">Lab 7.5: Kafka Streaming - Groupby</h1>
<h3 id="overview">Overview</h3>
<p>Apply <code>groupby</code> transformation on KStreams</p>
<h3 id="depends-on">Depends On</h3>
<p><a href="7.1-streaming-intro.html">7.1 streaming intro</a></p>
<h3 id="run-time">Run time</h3>
<p>20 mins</p>
<h2 id="step-1-clickstream-producer">Step 1: Clickstream Producer</h2>
<p>File : <code>src/main/java/x/utils/ClickStreamProducer.java</code></p>
<p>We will continue use this producer * Inspect file and make any fixes * Run the producer in Eclipse, Right click on the file and run as ‘Java Application’ * Make sure it is sending messages as follows - key : Domain - value : clickstream data - example : <code>key=facebook.com, value={&quot;timestamp&quot;:1451635200005,&quot;session&quot;:&quot;session_251&quot;,&quot;domain&quot;:&quot;facebook.com&quot;,&quot;cost&quot;:91,&quot;user&quot;:&quot;user_16&quot;,&quot;campaign&quot;:&quot;campaign_5&quot;,&quot;ip&quot;:&quot;ip_67&quot;,&quot;action&quot;:&quot;clicked&quot;}</code></p>
<h2 id="step-2-streaming-consumer-5">Step 2: Streaming Consumer 5</h2>
<p>File : <code>src/main/java/x/lab7_streaming/StreamingConsumer5_GroupBy.java</code></p>
<p>This consumer will apply the following transformation to a KafkaStream - map the incoming record into key value pair with (action,1) - aggregate all actions by - groupby action - and counting them</p>
<p><strong>=&gt; Inspect the file and fix the TODO items.</strong><br />
Use reference <a href="https://kafka.apache.org/0102/javadoc/index.html">Kafka Java API</a></p>
<h2 id="step-3-run">Step 3: Run</h2>
<ul>
<li>Run the <code>lab7_streaming/StreamingConsumer5_GroupBy</code> in Eclipse,</li>
<li>Run the <code>utils.ClickStreamProducer</code> in Eclipse,</li>
<li>Expected output</li>
</ul>
<pre class="console"><code>....

[KTABLE-TOSTREAM-0000000009]: clicked, 13
[KTABLE-TOSTREAM-0000000009]: blocked, 7
[KTABLE-TOSTREAM-0000000009]: viewed, 3
[KTABLE-TOSTREAM-0000000009]: clicked, 14
[KTABLE-TOSTREAM-0000000009]: blocked, 8
[KTABLE-TOSTREAM-0000000009]: clicked, 15
[KTABLE-TOSTREAM-0000000009]: blocked, 9
[KTABLE-TOSTREAM-0000000009]: clicked, 16
[KTABLE-TOSTREAM-0000000009]: clicked, 17
[KTABLE-TOSTREAM-0000000009]: blocked, 10</code></pre>
<h2 id="step-4-run-2">Step 4: Run 2</h2>
<ul>
<li>Run the <code>utils.ClickStreamProducer</code> in Eclipse</li>
<li>Notice the counts, what do you see?</li>
</ul>
<h2 id="step-5-bonus-lab-inspect-actioncount-topic">Step 5: Bonus Lab: Inspect ‘actionCount’ topic</h2>
<p>In this bonus lab, instead of printing the results to console, we are going to write it out to another Kafka topic.</p>
<p>Once you make the code changes, you can inspect Kafka topic as follows</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" data-line-number="1">  $   <span class="ex">~/kafka/bin</span>/<span class="ex">kafka-console-consumer.sh</span>\</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">      --bootstrap-server <span class="st">&quot;localhost:9092&quot;</span>\</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">      --from-beginning\</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">      --property print.key=true\</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">      --property value.deserializer=org.apache.kafka.common.serialization.LongDeserializer\</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">      --topic actionCount</a></code></pre></div>
